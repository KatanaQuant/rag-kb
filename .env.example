# =============================================================================
# RAG-KB Environment Configuration
# =============================================================================
# This file configures INFRASTRUCTURE settings (resources, ports, security).
#
# For ML/PIPELINE settings (models, chunking, reranking), see:
#   config/pipeline.yaml
#
# Configuration files:
#   .env              → Infrastructure (this file)
#   config/pipeline.yaml → ML pipeline (models, strategies)
#
# Copy this to .env and uncomment/modify the settings you need.
# After editing: docker-compose restart rag-api
# =============================================================================

# -----------------------------------------------------------------------------
# RESOURCE LIMITS (adjust based on your hardware)
# -----------------------------------------------------------------------------
# Detect your hardware: echo "CPU: $(nproc), RAM: $(free -g | awk '/^Mem:/{print $2}')GB"
#
# Balanced profile (50-60%): Good for multitasking
# MAX_CPUS=4.0          # 50% of 8 cores
# MAX_MEMORY=8G         # 60% of 13GB
#
# Performance profile (70-80%): Fast indexing, less responsive system
# MAX_CPUS=6.0          # 75% of 8 cores
# MAX_MEMORY=10G        # 80% of 13GB

# -----------------------------------------------------------------------------
# PORT CONFIGURATION
# -----------------------------------------------------------------------------
# RAG_PORT=8000         # Change if port 8000 is in use

# -----------------------------------------------------------------------------
# CONCURRENT PROCESSING (Worker threads)
# -----------------------------------------------------------------------------
# Note: Higher worker counts don't help due to Python GIL contention.
#
# EMBEDDING_WORKERS=2         # Keep at 2 (optimal for GIL)
# CHUNK_WORKERS=1             # Single chunker avoids resource contention
# EMBEDDING_BATCH_SIZE=32     # Chunks per model call (higher = faster, more RAM)
#
# Thread parallelism (NumPy/BLAS - releases GIL):
# OMP_NUM_THREADS=2           # OpenMP threads
# MKL_NUM_THREADS=2           # Intel MKL threads

# -----------------------------------------------------------------------------
# BATCH PROCESSING (legacy, for non-pipeline operations)
# -----------------------------------------------------------------------------
# BATCH_SIZE=5                # Files per batch
# BATCH_DELAY=0.5             # Delay between batches (seconds)

# -----------------------------------------------------------------------------
# FILE WATCHER (Auto-sync)
# -----------------------------------------------------------------------------
# WATCH_ENABLED=true                # Enable/disable auto-sync
# WATCH_DEBOUNCE_SECONDS=10.0       # Wait after last change before indexing
# WATCH_BATCH_SIZE=50               # Max files per batch

# -----------------------------------------------------------------------------
# QUERY CACHE
# -----------------------------------------------------------------------------
# CACHE_ENABLED=true          # Enable query result caching
# CACHE_MAX_SIZE=100          # Max cached queries (LRU eviction)

# -----------------------------------------------------------------------------
# RESUMABLE PROCESSING
# -----------------------------------------------------------------------------
# RESUMABLE_PROCESSING=true         # Handle interruptions gracefully
# PROCESSING_BATCH_SIZE=50          # Chunks before progress checkpoint
# PROCESSING_MAX_RETRIES=3          # Max retries for failed files
# CLEANUP_COMPLETED_PROGRESS=false  # Delete completed progress records

# -----------------------------------------------------------------------------
# SECURITY: File Type Validation
# -----------------------------------------------------------------------------
# Detects executables masquerading as documents (security feature)
# FILE_TYPE_VALIDATION_ENABLED=true   # Enable validation
# FILE_TYPE_VALIDATION_ACTION=reject  # reject|warn|skip

# -----------------------------------------------------------------------------
# SECURITY: Malware Detection
# -----------------------------------------------------------------------------
# CLAMAV_ENABLED=true                 # ClamAV virus scanning
# HASH_BLACKLIST_ENABLED=true         # Known malware hash detection
# YARA_ENABLED=true                   # YARA rule matching

# -----------------------------------------------------------------------------
# DATABASE MAINTENANCE (Startup health)
# -----------------------------------------------------------------------------
# AUTO_REPAIR_ORPHANS=true        # Auto-repair orphaned files on startup
# AUTO_SELF_HEAL=true             # Enable automatic database repairs

# -----------------------------------------------------------------------------
# EMBEDDING QUEUE MANAGEMENT
# -----------------------------------------------------------------------------
# MAX_PENDING_EMBEDDINGS=6        # Max queued embeddings before throttling

# -----------------------------------------------------------------------------
# PIPELINE ARCHITECTURE
# -----------------------------------------------------------------------------
# ENABLE_CONCURRENT_PIPELINE=true # Use concurrent 4-stage pipeline

# -----------------------------------------------------------------------------
# KNOWLEDGE BASE PATH (optional)
# -----------------------------------------------------------------------------
# Default: ./kb/ (mounted in Docker)
# For custom paths, also update docker-compose.yml volumes
#
# KB_PATH=/media/external_drive/documents
# KB_PATH=~/my_kb
# KB_PATH=/mnt/nas/kb
