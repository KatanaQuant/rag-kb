# Release v1.6.5 - Codebase Refactoring

**Release Date:** November 26, 2025

## Overview

Internal codebase refactoring for better organization and maintainability. No breaking API changes.

## What's Changed

### Directory Restructuring
- Renamed `services/` → `pipeline/` (background document processing)
- Renamed `api_services/` → `operations/` (API-facing operations)
- Clear separation: `pipeline/` handles Chunk→Embed→Store, `operations/` handles Query/List/Search

### Code Cleanup
- Removed duplicate `DocumentLister`, `DocumentSearcher` from routes
- Removed duplicate `DocumentRepository`, `ChunkRepository` from routes
- Routes now only contain HTTP handlers (Single Responsibility)
- Deleted dead code (`state/app_state.py`)

### Configuration Updates
- Changed `EMBEDDING_WORKERS` default from 3 to 2 (CPU-optimized)
- Updated docker-compose.yml with new volume mounts
- Updated CONFIGURATION.md with CPU vs GPU guidance

## Technical Details

- Test Suite: 638 passing, 15 skipped
- No database migration required
- No API changes

## Upgrade Instructions

### From v1.6.4
No action needed - just rebuild the Docker image:

```bash
docker-compose down
git pull
docker-compose build --no-cache
docker-compose up -d
```

### For Developers
If you have custom code importing from the old paths:
- `from services.X` → `from pipeline.X`
- `from api_services.X` → `from operations.X`

## Architecture

```
api/
├── pipeline/          # Background processing
│   ├── embedding_service.py
│   ├── indexing_queue.py
│   ├── indexing_worker.py
│   └── ...
├── operations/        # API operations
│   ├── query_executor.py
│   ├── document_lister.py
│   ├── document_searcher.py
│   └── ...
└── routes/            # HTTP handlers only
    ├── query.py
    ├── documents.py
    └── ...
```
