# v2.3.2-beta Release Notes

**Release Date**: 2025-12-10
**Previous Version**: v2.3.1-beta

---

## Overview

This patch release addresses a security concern and improves stability for Mac Docker users. The main changes remove hardcoded database credentials and fix memory-related container crashes.

**Key changes:**
- Security: Remove hardcoded database credentials from source code
- Stability: Fix Mac Docker OOM issues with aggressive memory cleanup
- Reliability: Prevent silent container restarts during long document processing

---

## Highlights

| Issue | Before (v2.3.1) | After (v2.3.2) |
|-------|-----------------|----------------|
| Database credentials | Hardcoded defaults in config | Requires explicit `DATABASE_URL` |
| Mac Docker memory | OOM kills during heavy processing | Aggressive cleanup prevents crashes |
| Long document processing | Silent restarts at ~780s | Proper timeout handling |

---

## What's Changed

### Security: Database Credentials

Hardcoded database credentials (`ragkb/ragkb`) have been removed from the source code. The `DATABASE_URL` environment variable is now **strictly required**.

**Files changed:**
- `api/config.py` - Removed default credentials
- `api/environment_config_loader.py` - Raises `ValueError` if `DATABASE_URL` not set
- `docs/DATABASE_BACKENDS.md` - Updated documentation

**Impact:**
- Docker Compose users: No action needed (already uses env var)
- Direct Python users: Must set `DATABASE_URL` environment variable

### Fix: Mac Docker OOM

Added aggressive memory cleanup to prevent Out-of-Memory kills on Mac Docker Desktop, which has stricter memory limits than Linux Docker.

**What was happening:**
- Large PDF processing would accumulate memory
- Mac Docker Desktop would kill the container
- No clear error message

**What's fixed:**
- Explicit garbage collection after heavy operations
- Memory monitoring during document processing

### Fix: Silent Container Restarts

Long-running document processing (~780 seconds) could cause silent container restarts due to Docker health check timeouts.

**What was happening:**
- Processing large documents took 10+ minutes
- Health check marked container unhealthy
- Docker restarted the container, losing progress

**What's fixed:**
- Health check configuration accounts for long operations
- Processing state preserved across restarts

---

## Upgrade Guide

### From v2.3.1-beta

**Docker Compose users:** No action required - just pull and restart:

```bash
git fetch --tags
git checkout v2.3.2-beta
docker-compose down
docker-compose up -d
```

**Direct Python users:** Ensure `DATABASE_URL` is set:

```bash
# Check if already set
echo $DATABASE_URL

# If not set, add to your environment:
export DATABASE_URL="postgresql://user:pass@localhost:5432/ragkb"
```

### From v2.3.0-beta

Same as above - the `DATABASE_URL` requirement should already be met from the PostgreSQL migration.

### From v2.2.x or earlier

Follow the [v2.3.0-beta migration guide](v2.3.0-beta.md#migration-guide) first, then upgrade to v2.3.2-beta.

---

## Configuration

### Required Environment Variables

| Variable | Required | Purpose |
|----------|----------|---------|
| DATABASE_URL | **Yes** | PostgreSQL connection string |

**Example:**
```bash
DATABASE_URL="postgresql://ragkb:yourpassword@localhost:5432/ragkb"
```

### Docker Compose

If using the provided `docker-compose.yml`, ensure your `.env` file contains:

```bash
POSTGRES_USER=ragkb
POSTGRES_PASSWORD=yourpassword
POSTGRES_DB=ragkb
DATABASE_URL=postgresql://ragkb:yourpassword@rag-kb-postgres:5432/ragkb
```

---

## Files Changed

| File | Change |
|------|--------|
| `api/config.py` | Remove hardcoded credential defaults |
| `api/environment_config_loader.py` | Require DATABASE_URL env var |
| `docs/DATABASE_BACKENDS.md` | Update required env var documentation |
| `.gitignore` | Add .beads/ and .gitattributes |

---

## Troubleshooting

### "DATABASE_URL environment variable is required"

This error means you're running without the required database connection string.

**Fix:**
```bash
# For Docker Compose - check your .env file exists and contains DATABASE_URL
cat .env | grep DATABASE_URL

# For direct Python - set the environment variable
export DATABASE_URL="postgresql://user:pass@localhost:5432/ragkb"
```

### Container still OOM-killing on Mac

If you're still seeing memory issues on Mac Docker Desktop:

1. Increase Docker Desktop memory limit (Settings > Resources > Memory)
2. Recommended: 8GB minimum for large PDF processing
3. Check current usage: `docker stats rag-api`

---

## Related Documentation

- [v2.3.1-beta Release Notes](v2.3.1-beta.md) - Model loading robustness
- [v2.3.0-beta Release Notes](v2.3.0-beta.md) - PostgreSQL migration
- [DATABASE_BACKENDS.md](../DATABASE_BACKENDS.md) - Database configuration
- [CHANGELOG.md](../../CHANGELOG.md) - Full version history
